---
title: "Addendum"
output: html_document
date: '2022-04-22'
---


# Addendum

## Text: Check number of countries with contact tracing
```{r number_of_countries_with_contact_tracing}
# Data from https://www.bsg.ox.ac.uk/research/research-projects/covid-19-government-response-tracker
# We claim that 
oxcgrt <- read_csv("data/OxCGRT_latest.csv")

numberofcountrieswithcontacttracing <- oxcgrt %>% 
  select(contacttracing = 'H3_Contact tracing', CountryName) %>% 
  filter(contacttracing>0) %>%
  select(CountryName) %>% 
  distinct() %>% 
  nrow()
  
numberofcountries <- oxcgrt %>% 
  select(CountryName) %>% 
  distinct() %>% 
  nrow()
```

`r numberofcountrieswithcontacttracing` of `r numberofcountries` countries do contact tracing.



## Graph: Overview of separation orders by week
```{r overview_figure, fig.cap = "separation order duration by week"}
df2 <- df %>% 
  mutate(meldezeit = floor_date(AbsonderungVon, "week"))  %>% 
  group_by(meldezeit, DatensatzKategorie, AgeGroup) %>% 
  mutate(durationsum = sum(dauer)/365)

df2 %>% ggplot(aes(x = meldezeit, y = durationsum, fill = AgeGroup)) +
  ester_theme() +
 geom_col() +
facet_wrap(~DatensatzKategorie + AgeGroup, ncol = 4) +
    # geom_vline(xintercept = floor_date(ymd("2020_10_01"), unit = "week")) +
  ylab("Duration in years") 
```


## Graph: Ratio-of-contact-person-to-case
```{r Ratio-of-contact-person-to-case, fig.cap="Ratio of contact person to case by defintion of contact person"}
 # resultslist$K_F_Verhaeltnis_QDef %>% 
 #  ggplot(aes(x = q_def, y = verhaeltnis)) + 
 #  ester_theme() +
 #  geom_bar(stat = "identity") +
 #  ylab("ratio contact persons to case") +
 #  xlab("") +
 #  ggtitle("Ratio of contact person to case by defintion of contact person") 
```

## Graph: Quarantines per isolation ratio per month
```{r KP-pro-Fall-pro-Monat, fig.cap="KP pro Fall pro Monat"}
df %>% 
  group_by(Meldemonat, DatensatzKategorie) %>% 
  count() %>% 
  pivot_wider(names_from = DatensatzKategorie, values_from = n) %>% 
  janitor::clean_names() %>% 
  mutate(verhaeltnis = kontakt_covid_19/covid_19) %>% 
  na.omit() %>% 
  ggplot(aes(x = meldemonat, y = verhaeltnis)) +
  ester_theme() +
  geom_bar(stat = "identity") 
```

## Graph: Duration over time
```{r graph-dauer-über-die-Zeit, fig.height = 15, fig.cap="Absonderungsdauern nach Meldemonat"}
ggplot(df, aes(as.numeric(dauer), fill = DatensatzKategorie)) +
  ester_theme() +
  geom_histogram(position = "dodge", bins = 30) +
  facet_wrap(~Q_Duration, scales = "free", ncol = 3) +
  scale_fill_brewer(palette=mypalette) +
  theme(legend.position = "bottom") +
  xlab("Absonderungsdauer") +
  ylab("Anzahl an Absonderungen")
```


## Graph: Overview over time periods
```{r zeiten, fig.cap="test"}
zeiten <- zeiten %>% 
  mutate(Q_Duration = str_extract(Q_Duration,"\\d+")) %>% 
  mutate(I_Duration = str_extract(I_Duration,"\\d+")) %>% 
  mutate(Q_Def = str_extract(Q_Def,"\\d+"))

graphtabelle <- bind_rows(
  zeiten %>% 
  group_by(Q_Duration) %>% 
  summarise(start = min(dates), end = max(dates)) %>% 
  mutate(group = "Q_Duration") %>% 
  rename(event = Q_Duration),
  zeiten %>% 
  group_by(I_Duration) %>% 
  summarise(start = min(dates), end = max(dates)) %>% 
  mutate(group = "I_Duration") %>% 
  rename(event = I_Duration),
  zeiten %>% 
  group_by(Q_Def) %>% 
  summarise(start = min(dates), end = max(dates)) %>% 
  mutate(group = "Q_Def") %>% 
  rename(event = Q_Def)
  )

gg_vistime(graphtabelle)
```


## Graph: Number of separation orders per person
```{r Anzahl-an-Absonderungen-pro-Person, fig.cap="Anzahl an Absonderungen pro Person"}
p1 <- df %>% group_by(AnonID) %>% 
  summarise(n = n()) %>% 
  ggplot(aes(n)) +
  ester_theme() +
  geom_bar(fill = brewer.pal(3, mypalette)[3]) +
  coord_cartesian(xlim =c(1, 5)) +
  ggtitle("Anzahl an Isolationen und Quarantänen") 

p2 <- df %>% 
  filter(DatensatzKategorie == "COVID-19") %>% 
  group_by(AnonID) %>% 
  summarise(n = n()) %>% 
  ggplot(aes(n)) +
  ester_theme() +
  geom_bar(fill = brewer.pal(3, mypalette)[1]) +
  coord_cartesian(xlim =c(1, 5)) +
  ggtitle("Anzahl an Isolationen") 
p3 <- df %>% 
  filter(DatensatzKategorie == "Kontakt-COVID-19") %>% 
  group_by(AnonID) %>% 
  summarise(n = n()) %>% 
  ggplot(aes(n)) +
  ester_theme() +  
  coord_cartesian(xlim =c(1, 5)) +
  geom_bar(fill = brewer.pal(3, mypalette)[2]) +
  ggtitle("Anzahl an Quarantänen") 

p_gesamt <- grid.arrange(p1,p2,p3)
ggsave("graph/zeitenuebersicht.png", p_gesamt)
```


# Linear models
## Linear model of influence an quarantine duration
```{r}
summary(lm(as.numeric(dauer)~AgeGroup+Q_Duration, df %>% filter(DatensatzKategorie == "Kontakt-COVID-19")))
```

## Linear model of influence an isolation duration
```{r}
summary(lm(as.numeric(dauer)~AgeGroup+I_Duration, df %>% filter(DatensatzKategorie == "COVID-19")))
```
